# Prerequisites

Terraform is an open-source infrastructure as code tool that enables you to safely and predictably provision and manage infrastructure in any cloud.

## Terraform

Install [Terraform](https://developer.hashicorp.com/terraform/tutorials/azure-get-started/install-cli)

## Azure CLI

Install [Azure CLI](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli).
Login into Azure cli `az login`. Make sure that `az account show` shows proper subscription.

## AWS CLI

[Install AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html).
[Configure AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html).

## S3 Bucket/Storage Account Container

This template utilizes remote state management for Terraform. Depending on your chosen cloud provider (AWS or Azure), you will need to manually create either an AWS S3 bucket or an Azure Storage Account container **before** you can apply the Terraform configuration using `terraform apply`.

This bucket/container is used by Terraform to store the state file (`terraform.tfstate`), which keeps track of the resources managed by your configuration. Storing the state file remotely is crucial for collaboration and prevents inconsistencies.

The default configuration expects a specific name and location/region for this storage resource. You can find and modify these default settings in the `main.ts` file located within the respective cloud provider's infrastructure definition directory (e.g., `aws/main.ts` for AWS or `azure/main.ts` for Azure - _Note: Verify the exact path in your project structure_).

# How to execute terraform scripts

## Initialize working directory

Before running any other Terraform commands, you need to initialize the working directory for your specific cloud provider (e.g., `azure`, `aws`). Navigate to the cloud provider's directory (e.g., `terraform/azure`) and run the following command:

```bash
terraform init
```

This command performs several crucial tasks:

-   **Downloads and installs provider plugins**
-   **Initializes backend configuration**
-   **Downloads modules**.

You only need to run `terraform init` once per working directory, or whenever you change the provider plugins, backend configuration, or module sources.

## Plan changes

Before generating the plan, you **must** update the variables in the `terraform.tfvars` file located within the specific cloud provider directory (e.g., `terraform/azure/terraform.tfvars` or `terraform/aws/terraform.tfvars`). These variables allow you to customize the deployment for your specific needs.

Common variables you'll need to configure:

-   `location` / `region`: Specifies the geographic region where your resources will be deployed (e.g., `westeurope` for Azure, `eu-west-1` for AWS).
-   `prefix`: A unique name prefix used for naming various resources (e.g., `myapp`, `projectx`).
-   `environment`: The deployment environment (e.g., `dev`, `staging`, `prod`). This is used as suffix in resource naming and tagging for organizational purposes.

After updating `terraform.tfvars`, run the following command from the cloud provider's directory (e.g., `terraform/azure` or `terraform/aws`):

```bash
terraform plan
```

Terraform will:

1.  Read the current state of any existing remote infrastructure (if applicable).
2.  Compare the current state with your configuration files (including the variables you set).
3.  Output a summary of the planned actions: which resources will be created, updated, or destroyed.

**Review the plan carefully** to ensure the proposed changes match your expectations before proceeding to apply them.

## Apply changes

After reviewing the plan generated by `terraform plan` and confirming the changes are correct, you can apply them to your cloud infrastructure.

Run the following command from the cloud provider's directory (e.g., `terraform/azure` or `terraform/aws`):

```bash
terraform apply
```

This command first performs a plan just like `terraform plan` does. It then presents the planned changes and prompts for your confirmation before proceeding.

Type `yes` and press Enter to approve and execute the changes.

Terraform will then interact with the cloud provider's API to create, update, or delete resources as outlined in the plan.

Once the apply process is complete, you can view the output values defined in your configuration (such as resource IDs, IP addresses, connection strings, etc.) using:

```bash
terraform output -json
```

This command displays the outputs in JSON format, which can be useful for scripting or feeding into other systems.
